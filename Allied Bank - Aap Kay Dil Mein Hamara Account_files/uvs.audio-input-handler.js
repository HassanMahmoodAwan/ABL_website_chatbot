window.AudioContext=window.AudioContext||window.webkitAudioContext;var uvsAudioContext=null;var uvsAudioInput=null,uvsRealAudioInput=null,uvsInputPoint=null,uvsAudioRecorder=null;var uvsRecIndex=0;var initCB=null;let uvsStream=null;function uvsInitAudio(cb){initCB=cb;try{let uvsLastUpdatedAtTimestamp=uvsServiceLogs.updatedAt||null;if(uvsLastUpdatedAtTimestamp!==null){uvsLastUpdatedAtTimestamp=Number(uvsLastUpdatedAtTimestamp);let currentUtcTimestamp=Math.round(new Date().getTime()/1000);uvsLastUpdatedAtTimestamp=uvsLastUpdatedAtTimestamp+(24*3600);if(currentUtcTimestamp>=uvsLastUpdatedAtTimestamp){uvsLogServiceCall(1);}}}catch(err){}
uvsAudioContext=new AudioContext();navigator.mediaDevices.getUserMedia({"audio":!0}).then(uvsGotStream).catch(function(e){uvsAudioPlayer.configure(uvsAlternativeResponse['micConnect']);uvsAudioPlayer.play();console.log("VF: We caught an error while gaining access to audio input due to: ",e.message);});}
function uvsGotStream(stream){uvsInputPoint=uvsAudioContext.createGain();uvsStream=stream;uvsRealAudioInput=uvsAudioContext.createMediaStreamSource(stream);uvsAudioInput=uvsRealAudioInput;uvsAudioInput.connect(uvsInputPoint);uvsAudioRecorder=new Recorder(uvsInputPoint);initCB(uvsAudioRecorder);}
function uvsStopAudio(){try{uvsStream.getTracks().forEach(function(track){track.stop();});uvsAudioContext.close();uvsAudioContext=null;}catch(err){console.log('UVS Exception: Unable to release audio resource due to: '+err.message);}}